version: "3.8"

services:
  letsrenew:
    image: letsrenew:local
    build:
      context: ..
      dockerfile: Dockerfile
    restart: unless-stopped
    networks:
      - letsnet
    ports:
      - "${LETSRENEW_STATUS_PORT:-8080}:8080" # status server port (configurable in the YAML)
    environment:
      # The container will read configuration from /etc/letsrenew/config.yml by default.
      # If you need to override, set LETSRENEW_CONFIG to a different path.
      - LETSRENEW_CONFIG=/etc/letsrenew/config.yml
    volumes:
      - ./data/certs:/data/certs:rw                # host path -> container cert storage (explicit host path)
      - ./container/etc/letsrenew/config.yml:/etc/letsrenew/config.yml:ro
      - ./host-ssh-config:/root/.ssh:ro             # mount host SSH config + keys (ensure secure permissions)
    command: ["bun", "./dist/cli.js"]

networks:
  letsnet:
    driver: bridge

